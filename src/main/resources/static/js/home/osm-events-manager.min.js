function em_load_jquery_css(){if(EM.ui_css&&0==jQuery("link#jquery-ui-css").length){var e=document.createElement("link");e.id="jquery-ui-css",e.rel="stylesheet",e.href=EM.ui_css,document.body.appendChild(e)}}function em_setup_datepicker(e){e=jQuery(e);var t={altFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,firstDay:EM.firstDay,yearRange:"-100:+10"};EM.dateFormat&&(t.dateFormat=EM.dateFormat),EM.yearRange&&(t.yearRange=EM.yearRange),jQuery(document).triggerHandler("em_datepicker",t),dateDivs=e.find(".em-date-single, .em-date-range"),dateDivs.length>0&&(dateDivs.find("input.em-date-input-loc").each(function(e,a){var i=(a=jQuery(a)).nextAll("input.em-date-input").first(),n=i.val();if(a.datepicker(t),a.datepicker("option","altField",i),n){var r=jQuery.datepicker.formatDate(EM.dateFormat,jQuery.datepicker.parseDate("yy-mm-dd",n));a.val(r),i.val(n)}a.change(function(){""==jQuery(this).val()&&jQuery(this).nextAll(".em-date-input").first().val("")})}),dateDivs.filter(".em-date-range").find("input.em-date-input-loc").each(function(e,t){if((t=jQuery(t)).hasClass("em-date-start"))t.datepicker("option","onSelect",function(e){var t=jQuery(this),a=t.parents(".em-date-range").find(".em-date-end").first(),i=t.nextAll("input.em-date-input").first().val(),n=a.nextAll("input.em-date-input").first().val();i>n&&""!=n&&(a.datepicker("setDate",e),a.trigger("change")),a.datepicker("option","minDate",e)});else if(t.hasClass("em-date-end")){var a=t.parents(".em-date-range").find(".em-date-start").first();""!=a.val()&&t.datepicker("option","minDate",a.val())}}))}function em_setup_timepicker(e){e=jQuery(e);var t={show24Hours:1==EM.show24hours,step:15};jQuery(document).triggerHandler("em_timepicker_options",t),e.find(".em-time-input").timePicker(t),e.find(".em-time-range input.em-time-start").each(function(e,t){jQuery(t).data("oldTime",jQuery.timePicker(t).getTime())}).change(function(){var e=jQuery(this),t=e.nextAll(".em-time-end");if(t.val()){var a=e.data("oldTime"),i=jQuery.timePicker(t).getTime()-a,n=jQuery.timePicker(e).getTime();jQuery.timePicker(t).getTime()>=a&&jQuery.timePicker(t).setTime(new Date(new Date(n.getTime()+i))),e.data("oldTime",n)}}),e.find(".em-time-range input.em-time-end").change(function(){var e=jQuery(this),t=e.prevAll(".em-time-start");t.val()&&(jQuery.timePicker(t).getTime()>jQuery.timePicker(this).getTime()&&(0==jQuery(".em-date-end").val().length||jQuery(".em-date-start").val()==jQuery(".em-date-end").val())?e.addClass("error"):e.removeClass("error"))}),e.find(".em-time-range input.em-time-all-day").change(function(){var e=jQuery(this);e.is(":checked")?e.siblings(".em-time-input").css("background-color","#ccc"):e.siblings(".em-time-input").css("background-color","#fff")}).trigger("change")}jQuery(document).ready(function(e){var t=!1;if(e("#start-time").each(function(t,a){e(a).addClass("em-time-input em-time-start").next("#end-time").addClass("em-time-input em-time-end").parent().addClass("em-time-range")}),e(".em-time-input").length>0&&em_setup_timepicker("body"),e(".em-calendar-wrapper a").unbind("click"),e(".em-calendar-wrapper a").undelegate("click"),e(".em-calendar-wrapper").delegate("a.em-calnav, a.em-calnav","click",function(t){t.preventDefault(),e(this).closest(".em-calendar-wrapper").prepend('<div class="loading" id="em-loading"></div>');var a=em_ajaxify(e(this).attr("href"));e(this).closest(".em-calendar-wrapper").load(a,function(){e(this).trigger("em_calendar_load")})}),e(document).delegate(".em-toggle","click change",function(t){t.preventDefault();var a=e(this),i=a.attr("rel").split(":");a.hasClass("show-search")?(i.length>1?a.closest(i[1]).find(i[0]).slideUp():e(i[0]).slideUp(),a.find(".show, .show-advanced").show(),a.find(".hide, .hide-advanced").hide(),a.removeClass("show-search")):(i.length>1?a.closest(i[1]).find(i[0]).slideDown():e(i[0]).slideDown(),a.find(".show, .show-advanced").hide(),a.find(".hide, .hide-advanced").show(),a.addClass("show-search"))}),EM.search_term_placeholder&&("placeholder"in document.createElement("input")?e("input.em-events-search-text, input.em-search-text").attr("placeholder",EM.search_term_placeholder):e("input.em-events-search-text, input.em-search-text").blur(function(){""==this.value&&(this.value=EM.search_term_placeholder)}).focus(function(){this.value==EM.search_term_placeholder&&(this.value="")}).trigger("blur")),e(".em-search-form select[name=country]").change(function(){var t=e(this);if(e(".em-search select[name=state]").html('<option value="">'+EM.txt_loading+"</option>"),e(".em-search select[name=region]").html('<option value="">'+EM.txt_loading+"</option>"),e(".em-search select[name=town]").html('<option value="">'+EM.txt_loading+"</option>"),""!=t.val()){t.closest(".em-search-location").find(".em-search-location-meta").slideDown();var a={action:"search_states",country:t.val(),return_html:!0};e(".em-search select[name=state]").load(EM.ajaxurl,a),a.action="search_regions",e(".em-search select[name=region]").load(EM.ajaxurl,a),a.action="search_towns",e(".em-search select[name=town]").load(EM.ajaxurl,a)}else t.closest(".em-search-location").find(".em-search-location-meta").slideUp()}),e(".em-search-form select[name=region]").change(function(){e(".em-search select[name=state]").html('<option value="">'+EM.txt_loading+"</option>"),e(".em-search select[name=town]").html('<option value="">'+EM.txt_loading+"</option>");var t={action:"search_states",region:e(this).val(),country:e(".em-search-form select[name=country]").val(),return_html:!0};e(".em-search select[name=state]").load(EM.ajaxurl,t),t.action="search_towns",e(".em-search select[name=town]").load(EM.ajaxurl,t)}),e(".em-search-form select[name=state]").change(function(){e(".em-search select[name=town]").html('<option value="">'+EM.txt_loading+"</option>");var t={action:"search_towns",state:e(this).val(),region:e(".em-search-form select[name=region]").val(),country:e(".em-search-form select[name=country]").val(),return_html:!0};e(".em-search select[name=town]").load(EM.ajaxurl,t)}),e(document).delegate(".em-search-form, .em-events-search-form","submit",function(t){var a=e(this);this.em_search&&this.em_search.value==EM.txt_search&&(this.em_search.value="");var i=a.closest(".em-search-wrapper").find(".em-search-ajax");if(0==i.length&&(i=e(".em-search-ajax")),i.length>0){i.append('<div class="loading" id="em-loading"></div>');var n=a.find(".em-search-submit");n.data("buttonText",n.val()).val(EM.txt_searching);var r=n.children("img");r.length>0&&r.attr("src",r.attr("src").replace("search-mag.png","search-loading.gif"));var o=a.serialize();return e.ajax(EM.ajaxurl,{type:"POST",dataType:"html",data:o,success:function(s){n.val(n.data("buttonText")),r.length>0&&r.attr("src",r.attr("src").replace("search-loading.gif","search-mag.png")),i.replaceWith(s),""==a.find("input[name=em_search]").val()&&a.find("input[name=em_search]").val(EM.txt_search),0==(i=a.closest(".em-search-wrapper").find(".em-search-ajax")).length&&(i=e(".em-search-ajax")),jQuery(document).triggerHandler("em_search_ajax",[o,i,t])}}),t.preventDefault(),!1}}),e(".em-search-ajax").length>0&&e(document).delegate(".em-search-ajax a.page-numbers","click",function(t){var a=e(this),i=a.closest(".em-pagination").attr("data-em-ajax"),n=a.closest(".em-search-ajax"),r=n.parent(),o=a.attr("href").split("?")[1];return""!=i&&(o=""!=o?o+"&"+i:i),n.append('<div class="loading" id="em-loading"></div>'),e.ajax(EM.ajaxurl,{type:"POST",dataType:"html",data:o,success:function(e){n.replaceWith(e),n=r.find(".em-search-ajax"),jQuery(document).triggerHandler("em_search_ajax",[o,n,t])}}),t.preventDefault(),!1}),e(".events-table").on("click",".em-event-delete",function(){if(!confirm("Are you sure you want to delete?"))return!1;window.location.href=this.href}),e("#event-form #event-image-delete, #location-form #location-image-delete").on("click",function(){var t=e(this);t.is(":checked")?t.closest(".event-form-image, .location-form-image").find("#event-image-img, #location-image-img").hide():t.closest(".event-form-image, .location-form-image").find("#event-image-img, #location-image-img").show()}),e("#event-form.em-event-admin-recurring").submit(function(t){var a=e(this);if(1==a.find('input[name="event_reschedule"]').first().val())var i=EM.event_reschedule_warning;else if(1==a.find('input[name="event_recreate_tickets"]').first().val())i=EM.event_recurrence_bookings;else i=EM.event_recurrence_overwrite;confirmation=confirm(i),0==confirmation&&t.preventDefault()}),e(".em-reschedule-trigger").click(function(t){t.preventDefault();var a=e(this);a.closest(".em-recurrence-reschedule").find(a.data("target")).removeClass("reschedule-hidden"),a.siblings(".em-reschedule-value").val(1),a.addClass("reschedule-hidden").siblings("a").removeClass("reschedule-hidden")}),e(".em-reschedule-cancel").click(function(t){t.preventDefault();var a=e(this);a.closest(".em-recurrence-reschedule").find(a.data("target")).addClass("reschedule-hidden"),a.siblings(".em-reschedule-value").val(0),a.addClass("reschedule-hidden").siblings("a").removeClass("reschedule-hidden")}),e("#em-tickets-form").length>0){e("#event-rsvp").click(function(t){this.checked?e("#event-rsvp-options").fadeIn():(confirmation=confirm(EM.disable_bookings_warning),0==confirmation?t.preventDefault():e("#event-rsvp-options").hide())}),e("input#event-rsvp").is(":checked")?e("div#rsvp-data").fadeIn():e("div#rsvp-data").hide();var a=function(){e("#em-tickets-form table tbody tr.em-tickets-row").show(),e("#em-tickets-form table tbody tr.em-tickets-row-form").hide()};e("#em-recurrence-checkbox").length>0?e("#em-recurrence-checkbox").change(function(){e("#em-recurrence-checkbox").is(":checked")?(e("#em-tickets-form .ticket-dates-from-recurring, #em-tickets-form .ticket-dates-to-recurring, #event-rsvp-options .em-booking-date-recurring").show(),e("#em-tickets-form .ticket-dates-from-normal, #em-tickets-form .ticket-dates-to-normal, #event-rsvp-options .em-booking-date-normal, #em-tickets-form .hidden").hide()):(e("#em-tickets-form .ticket-dates-from-normal, #em-tickets-form .ticket-dates-to-normal, #event-rsvp-options .em-booking-date-normal").show(),e("#em-tickets-form .ticket-dates-from-recurring, #em-tickets-form .ticket-dates-to-recurring, #event-rsvp-options .em-booking-date-recurring, #em-tickets-form .hidden").hide())}).trigger("change"):e("#em-form-recurrence").length>0?(e("#em-tickets-form .ticket-dates-from-recurring, #em-tickets-form .ticket-dates-to-recurring, #event-rsvp-options .em-booking-date-recurring").show(),e("#em-tickets-form .ticket-dates-from-normal, #em-tickets-form .ticket-dates-to-normal, #event-rsvp-options .em-booking-date-normal, #em-tickets-form .hidden").hide()):e("#em-tickets-form .ticket-dates-from-recurring, #em-tickets-form .ticket-dates-to-recurring, #event-rsvp-options .em-booking-date-recurring, #em-tickets-form .hidden").hide(),e("#em-tickets-add").click(function(t){t.preventDefault(),a();var i=e("#em-tickets-form table tbody"),n=i.length+1,r=i.first().clone(!0).attr("id","em-ticket-"+n).appendTo(e("#em-tickets-form table"));r.find("*[name]").each(function(t,a){(a=e(a)).attr("name",a.attr("name").replace("em_tickets[0]","em_tickets["+n+"]"))}),r.show().find(".ticket-actions-edit").trigger("click"),r.find(".em-date-input-loc").datepicker("destroy").removeAttr("id"),r.find(".em-time-input").unbind().each(function(e,t){this.timePicker=!1}),em_setup_datepicker(r),em_setup_timepicker(r),e("html, body").animate({scrollTop:r.offset().top-30})}),e(document).delegate(".ticket-actions-edit","click",function(t){t.preventDefault(),a();var i=e(this).closest("tbody");return i.find("tr.em-tickets-row").hide(),i.find("tr.em-tickets-row-form").fadeIn(),!1}),e(document).delegate(".ticket-actions-edited","click",function(t){t.preventDefault();var a=e(this).closest("tbody"),i=a.attr("id").replace("em-ticket-","");return a.find(".em-tickets-row").fadeIn(),a.find(".em-tickets-row-form").hide(),a.find("*[name]").each(function(t,n){if("ticket_start_pub"==(n=e(n)).attr("name"))a.find("span.ticket_start").text(n.attr("value"));else if("ticket_end_pub"==n.attr("name"))a.find("span.ticket_end").text(n.attr("value"));else if(n.attr("name")=="em_tickets["+i+"][ticket_type]")"members"==n.find(":selected").val()&&a.find("span.ticket_name").prepend("* ");else if(n.attr("name")=="em_tickets["+i+"][ticket_start_recurring_days]"){var r="before"==a.find("select.ticket-dates-from-recurring-when").val()?"-"+n.attr("value"):n.attr("value");""!=n.attr("value")?(a.find("span.ticket_start_recurring_days").text(r),a.find("span.ticket_start_recurring_days_text, span.ticket_start_time").removeClass("hidden").show()):(a.find("span.ticket_start_recurring_days").text(" - "),a.find("span.ticket_start_recurring_days_text, span.ticket_start_time").removeClass("hidden").hide())}else if(n.attr("name")=="em_tickets["+i+"][ticket_end_recurring_days]"){r="before"==a.find("select.ticket-dates-to-recurring-when").val()?"-"+n.attr("value"):n.attr("value");""!=n.attr("value")?(a.find("span.ticket_end_recurring_days").text(r),a.find("span.ticket_end_recurring_days_text, span.ticket_end_time").removeClass("hidden").show()):(a.find("span.ticket_end_recurring_days").text(" - "),a.find("span.ticket_end_recurring_days_text, span.ticket_end_time").removeClass("hidden").hide())}else a.find("."+n.attr("name").replace("em_tickets["+i+"][","").replace("]","").replace("[]","")).text(n.attr("value"))}),e(document).triggerHandler("em_maps_tickets_edit",[a,i,!0]),e("html, body").animate({scrollTop:a.parent().offset().top-30}),!1}),e(document).delegate(".em-ticket-form select.ticket_type","change",function(t){var a=e(this);"members"==a.find("option:selected").val()?a.closest(".em-ticket-form").find(".ticket-roles").fadeIn():a.closest(".em-ticket-form").find(".ticket-roles").hide()}),e(document).delegate(".em-ticket-form .ticket-options-advanced","click",function(t){t.preventDefault();var a=e(this);a.hasClass("show")?(a.closest(".em-ticket-form").find(".em-ticket-form-advanced").fadeIn(),a.find(".show,.show-advanced").hide(),a.find(".hide,.hide-advanced").show()):(a.closest(".em-ticket-form").find(".em-ticket-form-advanced").hide(),a.find(".show,.show-advanced").show(),a.find(".hide,.hide-advanced").hide()),a.toggleClass("show")}),e(".em-ticket-form").each(function(){var t=!1,a=e(this);a.find('.em-ticket-form-advanced input[type="text"]').each(function(){""!=this.value&&(t=!0)}),a.find('.em-ticket-form-advanced input[type="checkbox"]:checked').length>0&&(t=!0),a.find(".em-ticket-form-advanced option:selected").each(function(){""!=this.value&&(t=!0)}),t&&a.find(".ticket-options-advanced").trigger("click")}),e(document).delegate(".ticket-actions-delete","click",function(t){t.preventDefault();var a=e(this),i=a.closest("tbody");return i.find("input.ticket_id").val()>0?(a.text("Deleting..."),e.getJSON(e(this).attr("href"),{em_ajax_action:"delete_ticket",id:i.find("input.ticket_id").val()},function(e){e.result?i.remove():(a.text("Delete"),alert(e.error))})):i.remove(),!1})}if(e("#em-bookings-table").length>0){e(document).delegate("#em-bookings-table .tablenav-pages a","click",function(){var t=e(this),a=t.parents("#em-bookings-table form.bookings-filter"),i=t.attr("href").match(/#[0-9]+/);if(null!=i&&i.length>0){var n=i[0].replace("#","");a.find("input[name=pno]").val(n)}else a.find("input[name=pno]").val(1);return a.trigger("submit"),!1});var i={modal:!0,autoOpen:!1,minWidth:500,height:"auto",buttons:[{text:EM.bookings_settings_save,click:function(t){t.preventDefault();var a=e("#em-bookings-table form.bookings-filter [name=cols]").val(""),i=e("form#em-bookings-table-settings-form input.em-bookings-col-item");e.each(i,function(e,t){1==t.value&&(""!=a.val()?a.val(a.val()+","+t.name):a.val(t.name))}),e("#em-bookings-table-settings").trigger("submitted"),e("#em-bookings-table form.bookings-filter").trigger("submit"),e(this).dialog("close")}}]},n={modal:!0,autoOpen:!1,minWidth:500,height:"auto",buttons:[{text:EM.bookings_export_save,click:function(t){e(this).children("form").submit(),e(this).dialog("close")}}]};if(e("#em-bookings-table-settings").length>0){e("#em-bookings-table-settings").dialog(i),e(document).delegate("#em-bookings-table-settings-trigger","click",function(t){t.preventDefault(),e("#em-bookings-table-settings").dialog("open")}),e("#em-bookings-table-export").dialog(n),e(document).delegate("#em-bookings-table-export-trigger","click",function(t){t.preventDefault(),e("#em-bookings-table-export").dialog("open")});var r=function(){e("#em-bookings-table-export-form input[name=show_tickets]").is(":checked")?(e("#em-bookings-table-export-form .em-bookings-col-item-ticket").show(),e("#em-bookings-table-export-form #em-bookings-export-cols-active .em-bookings-col-item-ticket input").val(1)):e("#em-bookings-table-export-form .em-bookings-col-item-ticket").hide().find("input").val(0)};e("#em-bookings-table form select").each(function(t,a){e(a).change(function(t){var a=e(this),i=e("#em-bookings-table-export-form input[name="+a.attr("name")+"]"),n=a.find("option:selected");i.val(n.val())})}),r(),e("#em-bookings-table-export-form input[name=show_tickets]").click(r),e(".em-bookings-cols-sortable").sortable({connectWith:".em-bookings-cols-sortable",update:function(e,t){t.item.parents("ul#em-bookings-cols-active, ul#em-bookings-export-cols-active").length>0?t.item.addClass("ui-state-highlight").removeClass("ui-state-default").children("input").val(1):t.item.addClass("ui-state-default").removeClass("ui-state-highlight").children("input").val(0)}}).disableSelection(),t=!0}e(document).delegate("#em-bookings-table form.bookings-filter","submit",function(t){var a=e(this);return a.parents("#em-bookings-table").find(".table-wrap").first().append('<div id="em-loading" />'),e.post(EM.ajaxurl,a.serializeArray(),function(t){var i=a.parents("#em-bookings-table").first();i.replaceWith(t),e("#em-bookings-table-export input[name=scope]").val(i.find("select[name=scope]").val()),e("#em-bookings-table-export input[name=status]").val(i.find("select[name=status]").val()),jQuery(document).triggerHandler("em_bookings_filtered",[t,i,a])}),!1}),e(document).delegate(".em-bookings-approve,.em-bookings-reject,.em-bookings-unapprove,.em-bookings-delete","click",function(){var t=e(this);if(t.hasClass("em-bookings-delete")&&!confirm(EM.booking_delete))return!1;var a=em_ajaxify(t.attr("href")),i=t.parents("td").first();return i.html(EM.txt_loading),i.load(a),!1})}function o(){e(".interval-desc").hide();var t="-plural";1!=e("input#recurrence-interval").val()&&""!=e("input#recurrence-interval").val()||(t="-singular");var a="span#interval-"+e("select#recurrence-frequency").val()+t;e(a).show()}function s(){e("p.alternate-selector").hide(),e("p#"+e("select#recurrence-frequency").val()+"-selector").show()}function c(){e("input#event-recurrence").is(":checked")?(e("#event_recurrence_pattern").fadeIn(),e("#event-date-explanation").hide(),e("#recurrence-dates-explanation").show(),e("h3#recurrence-dates-title").show(),e("h3#event-date-title").hide()):(e("#event_recurrence_pattern").hide(),e("#recurrence-dates-explanation").hide(),e("#event-date-explanation").show(),e("h3#recurrence-dates-title").hide(),e("h3#event-date-title").show())}e(".em_bookings_events_table").length>0&&(e(document).delegate(".em_bookings_events_table form","submit",function(t){var a=e(this),i=em_ajaxify(a.attr("action"));return a.parents(".em_bookings_events_table").find(".table-wrap").first().append('<div id="em-loading" />'),e.get(i,a.serializeArray(),function(e){a.parents(".em_bookings_events_table").first().replaceWith(e)}),!1}),e(document).delegate(".em_bookings_events_table .tablenav-pages a","click",function(){var t=e(this),a=em_ajaxify(t.attr("href"));return t.parents(".em_bookings_events_table").find(".table-wrap").first().append('<div id="em-loading" />'),e.get(a,function(e){t.parents(".em_bookings_events_table").first().replaceWith(e)}),!1})),e(document).on("click","a.em-booking-button",function(t){t.preventDefault();var a=e(this);if(a.text()!=EM.bb_booked&&e(this).text()!=EM.bb_booking){a.text(EM.bb_booking);var i=a.attr("id").split("_");e.ajax({url:EM.ajaxurl,dataType:"jsonp",data:{event_id:i[1],_wpnonce:i[2],action:"booking_add_one"},success:function(e,t,i,n){e.result?a.text(EM.bb_booked):a.text(EM.bb_error),""!=e.message&&alert(e.message)},error:function(){a.text(EM.bb_error)}})}return!1}),e(document).on("click","a.em-cancel-button",function(t){t.preventDefault();var a=e(this);if(a.text()!=EM.bb_cancelled&&a.text()!=EM.bb_canceling){a.text(EM.bb_canceling);var i=a.attr("id").split("_");e.ajax({url:EM.ajaxurl,dataType:"jsonp",data:{booking_id:i[1],_wpnonce:i[2],action:"booking_cancel"},success:function(e,t,i,n){e.result?a.text(EM.bb_cancelled):a.text(EM.bb_cancel_error)},error:function(){a.text(EM.bb_cancel_error)}})}return!1}),e(".em-date-single, .em-date-range, #em-date-start").length>0&&(t=!0,em_setup_datepicker("body")),t&&em_load_jquery_css(),e("#recurrence-dates-explanation").hide(),e("#date-to-submit").hide(),e("#end-date-to-submit").hide(),e("#localised-date").show(),e("#localised-end-date").show(),e("#em-wrapper input.select-all").change(function(){e(this).is(":checked")?(e("input.row-selector").prop("checked",!0),e("input.select-all").prop("checked",!0)):(e("input.row-selector").prop("checked",!1),e("input.select-all").prop("checked",!1))}),o(),s(),c(),e("input#event-recurrence").change(c),e("input#recurrence-interval").keyup(o),e("select#recurrence-frequency").change(o),e("select#recurrence-frequency").change(s),e(".em-location-map").length>0||e(".em-locations-map").length>0||e("#em-map").length>0||e(".em-search-geo").length,jQuery("div.em-location-data input#location-name").length>0&&(jQuery("div.em-location-data input#location-name").autocomplete({source:EM.locationajaxurl,minLength:2,focus:function(e,t){return jQuery("input#location-id").val(t.item.value),!1},select:function(t,a){return jQuery("input#location-name").val(a.item.value),jQuery("input#location-address").val(a.item.address),jQuery("input#location-town").val(a.item.town),jQuery("input#location-state").val(a.item.state),jQuery("input#location-region").val(a.item.region),jQuery("input#location-postcode").val(a.item.postcode),""==a.item.country?jQuery("select#location-country option:selected").removeAttr("selected"):jQuery('select#location-country option[value="'+a.item.country+'"]').attr("selected","selected"),jQuery("div.em-location-data input, div.em-location-data select").css("background-color","#ccc").attr("readonly","readonly"),jQuery("#em-location-reset").show(),jQuery("#em-location-search-tip").hide(),jQuery(document).triggerHandler("em_locations_autocomplete_selected",[t,a]),e("#osm-button").hide(),e("#location-latitude").val(a.item.latitude),e("#location-longitude").val(a.item.longitude),e("#location-id").val(a.item.id),marker.setLatLng([a.item.latitude,a.item.longitude]).bindPopup(a.item.value).openPopup(),map.setView([a.item.latitude,a.item.longitude],zoomLevel),!1}}).data("ui-autocomplete")._renderItem=function(e,t){return html_val="<a>"+em_esc_attr(t.label)+'<br><span style="font-size:11px"><em>'+em_esc_attr(t.address)+", "+em_esc_attr(t.town)+"</em></span></a>",jQuery("<li></li>").data("item.autocomplete",t).append(html_val).appendTo(e)},jQuery("#em-location-reset a").click(function(){return jQuery("div.em-location-data input").css("background-color","#fff").val("").removeAttr("readonly"),jQuery("div.em-location-data select").css("background-color","#fff"),jQuery("div.em-location-data option:selected").removeAttr("selected"),jQuery("#em-location-reset").hide(),jQuery("#em-location-search-tip").show(),e("#osm-button").show(),e("#location-latitude").val(""),e("#location-longitude").val(""),e("#location-id").val(""),e("#location-country").val(defCountry),map.setView([0,0],1),marker.setLatLng([0,0]).bindPopup(" ").closePopup(),marker.dragging.enable(),marker.on("dragend",function(e){document.getElementById("location-latitude").value=marker.getLatLng().lat,document.getElementById("location-longitude").value=marker.getLatLng().lng}),!1}),"0"!=jQuery("input#location-id").val()&&""!=jQuery("input#location-id").val()&&(jQuery("div.em-location-data input, div.em-location-data select").css("background-color","#ccc").attr("readonly","readonly"),jQuery("#em-location-reset").show(),jQuery("#em-location-search-tip").hide(),e("#osm-button").hide()))});var em_ajaxify=function(e){return-1!=e.search("em_ajax=0")?e=e.replace("em_ajax=0","em_ajax=1"):-1!=e.search(/\?/)?e+="&em_ajax=1":e+="?em_ajax=1",e};function em_esc_attr(e){return"string"!=typeof e?"":e.replace(/</gi,"&lt;").replace(/>/gi,"&gt;")}!function(e){function t(t,a,i,n){t.value=e(a).text(),e(t).change(),navigator.userAgent.match(/msie/i)||t.focus(),i.hide()}function a(e,t){var a=e.getHours(),n=t.show24Hours?a:(a+11)%12+1,r=e.getMinutes();return i(n)+t.separator+i(r)+(t.show24Hours?"":a<12?" AM":" PM")}function i(e){return(e<10?"0":"")+e}function n(e,t){return"object"==typeof e?o(e):r(e,t)}function r(e,t){if(e){var a=e.split(t.separator),i=parseFloat(a[0]),n=parseFloat(a[1]);return t.show24Hours||(12===i&&-1!==e.indexOf("AM")?i=0:12!==i&&-1!==e.indexOf("PM")&&(i+=12)),o(new Date(0,0,0,i,n,0))}return null}function o(e){return e.setFullYear(2001),e.setMonth(0),e.setDate(0),e}e.fn.timePicker=function(t){var a=e.extend({},e.fn.timePicker.defaults,t);return this.each(function(){e.timePicker(this,a)})},e.timePicker=function(t,a){var i=e(t)[0];return i.timePicker||(i.timePicker=new jQuery._timePicker(i,a))},e.timePicker.version="0.3",e._timePicker=function(i,s){var c=!1,l=!1,d=n(s.startTime,s),m=n(s.endTime,s),u="selected",f="li."+u;e(i).attr("autocomplete","OFF");for(var h=[],p=new Date(d);p<=m;)h[h.length]=a(p,s),p=new Date(p.setMinutes(p.getMinutes()+s.step));for(var g=e('<div class="time-picker'+(s.show24Hours?"":" time-picker-12hours")+'"></div>'),v=e("<ul></ul>"),k=0;k<h.length;k++)v.append("<li>"+h[k]+"</li>");g.append(v),g.appendTo("body").hide(),g.mouseover(function(){c=!0}).mouseout(function(){c=!1}),e("li",v).mouseover(function(){l||(e(f,g).removeClass(u),e(this).addClass(u))}).mousedown(function(){c=!0}).click(function(){t(i,this,g),c=!1});var _=function(){if(g.is(":visible"))return!1;e("li",g).removeClass(u);var t=e(i).offset();g.css({top:t.top+i.offsetHeight,left:t.left}),g.show();var n=i.value?r(i.value,s):d,c=60*d.getHours()+d.getMinutes(),l=60*n.getHours()+n.getMinutes()-c,f=Math.round(l/s.step),h=o(new Date(0,0,0,0,f*s.step+c,0)),p=e("li:contains("+a(h=d<h&&h<=m?h:d,s)+")",g);return p.length&&(p.addClass(u),g[0].scrollTop=p[0].offsetTop),!0};e(i).focus(_).click(_),e(i).blur(function(){c||g.hide()}),e(i).keydown(function(a){var n;l=!0;var r=g[0].scrollTop;switch(a.keyCode){case 38:if(_())return!1;var o=(n=e(f,v)).prev().addClass(u)[0];return o?(n.removeClass(u),o.offsetTop<r&&(g[0].scrollTop=r-o.offsetHeight)):(n.removeClass(u),o=e("li:last",v).addClass(u)[0],g[0].scrollTop=o.offsetTop-o.offsetHeight),!1;case 40:if(_())return!1;var s=(n=e(f,v)).next().addClass(u)[0];return s?(n.removeClass(u),s.offsetTop+s.offsetHeight>r+g[0].offsetHeight&&(g[0].scrollTop=r+s.offsetHeight)):(n.removeClass(u),s=e("li:first",v).addClass(u)[0],g[0].scrollTop=0),!1;case 13:if(g.is(":visible")){var c=e(f,v)[0];t(i,c,g)}return!1;case 27:return g.hide(),!1}return!0}),e(i).keyup(function(e){l=!1}),this.getTime=function(){return r(i.value,s)},this.setTime=function(t){i.value=a(n(t,s),s),e(i).change()}},e.fn.timePicker.defaults={step:30,startTime:new Date(0,0,0,0,0,0),endTime:new Date(0,0,0,23,30,0),separator:":",show24Hours:!0}}(jQuery);
